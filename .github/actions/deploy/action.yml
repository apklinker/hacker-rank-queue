name: Deploy
inputs:
  environment:
    description: 'Name of the environment to deploy to (DEV/PROD)'
    required: true

runs:
  using: composite
  steps:
    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ env.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ env.AWS_SECRET_ACCESS_KEY }}
        aws-session-token: ${{ env.AWS_SESSION_TOKEN }}
        aws-region: us-east-1
        role-to-assume: ${{ env[format('{0}_ROLE_ARN', inputs.environment)] }}
        role-duration-seconds: 900
        role-session-name: DeployTo${{ inputs.environment }}
    
    
    - name: Deploy to Dev
      run: cd .aws && yarn infra:up && cd ..
